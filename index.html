<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Joe‚Äôs Pizzaria</title>
  <style>
    :root{
      --bg:#0f0f10;--card:#17181b;--muted:#9aa0a6;--txt:#f1f3f4;--brand:#ff7a00;
    }
    *{box-sizing:border-box;font-family:system-ui,Segoe UI,Roboto,sans-serif}
    body{margin:0;background:var(--bg);color:var(--txt)}
    header{padding:20px 16px;border-bottom:1px solid var(--card)}
    header h1{margin:0;font-size:22px}
    header p{margin:6px 0 0;color:var(--muted)}
    .wrap{max-width:980px;margin:0 auto;padding:16px}
    .item{display:flex;justify-content:space-between;align-items:center;background:var(--card);padding:12px;border-radius:8px;margin-bottom:10px}
    .item h3{margin:0 0 4px}
    .muted{color:var(--muted);font-size:14px}
    input[type=number]{width:50px;text-align:center;padding:4px}
    input,select,textarea{width:100%;padding:8px;border-radius:6px;border:1px solid #333;background:#1f1f1f;color:var(--txt);margin-top:4px}
    .btn{background:var(--brand);border:none;color:#fff;padding:10px 14px;border-radius:6px;cursor:pointer;width:100%}
    .btn:disabled{background:#555;cursor:not-allowed}
    .cart-item{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
    .total{display:flex;justify-content:space-between;margin-top:8px;font-weight:bold}
    .pill{display:inline-block;background:var(--muted);padding:2px 8px;border-radius:12px;font-size:12px;color:#111}
    .small{font-size:13px;color:var(--muted)}
  </style>
</head>
<body>
  <header>
    <h1>Joe‚Äôs Pizzaria</h1>
    <p>üçï Pizzas artesanais de 30 cm ‚Äî pre√ßo √∫nico R$ 35</p>
  </header>

  <div class="wrap">
    <h2>Card√°pio</h2>
    <div id="menu"></div>

    <h2>Carrinho</h2>
    <div id="cart"></div>

    <h2>Entrega e Pagamento</h2>

    <label>Forma de entrega:</label>
    <select id="retirada">
      <option>Retirada no t√©rreo</option>
      <option>Entrega no condom√≠nio</option>
    </select><br><br>

    <label>Rua:</label>
    <input id="rua" placeholder="Ex: Rua das Palmeiras"><br><br>

    <label>Casa / Bloco:</label>
    <input id="bloco" placeholder="Ex: Bloco B ou Casa 12"><br><br>

    <label>Apartamento:</label>
    <input id="apto" placeholder="Ex: 302"><br><br>

    <label>Hor√°rio desejado:</label>
    <input id="janela" placeholder="Ex: 19h - 19h30"><br><br>

    <label>Pagamento:</label>
    <select id="pagamento">
      <option>Pix</option>
      <option>Dinheiro</option>
    </select><br><br>

    <label>Observa√ß√µes:</label>
    <textarea id="obs" rows="2"></textarea><br><br>

    <button id="btnEnviar" class="btn" disabled>Enviar pedido pelo WhatsApp</button>

    <p class="small">üí≥ Chave Pix: <span id="pixKeyLabel">51998071649</span></p>
  </div>

  <script>
    const WHATSAPP_NUMBER="5551998071649", PIX_KEY="51998071649";
    document.getElementById("pixKeyLabel").textContent=PIX_KEY;
    const PRECO=35.00, TAMANHO="30 cm";

    function formatBR(n){return n.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});}
    const menuEl=document.getElementById('menu');
    let cart=[];

    // Carregar menu do arquivo menu.json
    async function carregarMenu(){
      try{
        const resp = await fetch('./menu.json',{cache:'no-store'});
        const MENU = await resp.json();
        menuEl.innerHTML='';
        MENU.forEach(p=>{
          const esgotado=p.available===false;
          const el=document.createElement('div');
          el.className='item';
          el.innerHTML=`
            <div style="flex:1">
              <h3>${p.nome} ${esgotado?'<span class="pill">Esgotada</span>':''}</h3>
              <div class="muted">${p.desc}</div>
              <div style="margin-top:8px">
                <input id="qty-${p.id}" type="number" min="1" value="1" ${esgotado?'disabled':''}>
                <button class="btn" ${esgotado?'disabled':''} onclick="addToCart(${p.id}, '${p.nome}')">Adicionar</button>
              </div>
            </div>
            <div class="price">${formatBR(PRECO)}</div>`;
          menuEl.appendChild(el);
        });
      }catch(e){
        menuEl.innerHTML='<p class="muted">N√£o consegui carregar o card√°pio.</p>';
      }
    }
    carregarMenu();

    function addToCart(id,nome){
      const qty=parseInt(document.getElementById(`qty-${id}`).value||1,10);
      cart.push({id:Date.now(),nome,tamanho:TAMANHO,precoUnit:PRECO,qty});
      renderCart();
    }
    function removeItem(id){cart=cart.filter(i=>i.id!==id);renderCart();}

    function renderCart(){
      const cartEl=document.getElementById('cart');
      if(cart.length===0){
        cartEl.innerHTML='<p class="small">Seu carrinho est√° vazio.</p>';
        document.getElementById('btnEnviar').disabled=true;return;
      }
      let html=cart.map(i=>`
        <div class="cart-item">
          <div><b>${i.nome}</b> ‚Äî ${i.tamanho}
            <div class="small">Qtd ${i.qty} ¬∑ ${formatBR(i.precoUnit)} un.</div>
          </div>
          <button onclick="removeItem(${i.id})">remover</button>
        </div>`).join('');
      const subtotal=cart.reduce((s,i)=>s+i.precoUnit*i.qty,0);
      const taxa=(document.getElementById('retirada')?.value==='Entrega no condom√≠nio')?5:0;
      const total=subtotal+taxa;
      html+=`
        <div class="total"><span>Subtotal</span><span>${formatBR(subtotal)}</span></div>
        <div class="total"><span>Entrega</span><span>${formatBR(taxa)}</span></div>
        <div class="total"><span>Total</span><span>${formatBR(total)}</span></div>`;
      cartEl.innerHTML=html;
      document.getElementById('btnEnviar').disabled=false;
    }

    function montarMensagem(){
      const retirada=document.getElementById('retirada').value;
      const rua=document.getElementById('rua').value.trim();
      const bloco=document.getElementById('bloco').value.trim();
      const apto=document.getElementById('apto').value.trim();
      const janela=document.getElementById('janela').value;
      const pagamento=document.getElementById('pagamento').value;
      const obs=document.getElementById('obs').value.trim();
      const linhas=["*Novo pedido ‚Äî Joe‚Äôs Pizzaria*","\n*Itens:*"];
      cart.forEach(i=>linhas.push(`‚Ä¢ ${i.qty}x ${i.nome} (${i.tamanho}) ‚Äî ${formatBR(i.precoUnit*i.qty)}`));
      const subtotal=cart.reduce((s,i)=>s+i.precoUnit*i.qty,0);
      const taxa=(retirada==='Entrega no condom√≠nio')?5:0;
      const total=subtotal+taxa;
      linhas.push(`\nSubtotal: ${formatBR(subtotal)}`);
      linhas.push(`Entrega: ${formatBR(taxa)}`);
      linhas.push(`*Total:* ${formatBR(total)}`);
      linhas.push(`\n*Forma de entrega:* ${retirada}`);
      if(rua){linhas.push(`Rua: ${rua}`);}
      if(bloco){linhas.push(`Bloco/Casa: ${bloco}`);}
      if(apto){linhas.push(`Apartamento: ${apto}`);}
      linhas.push(`*Hor√°rio:* ${janela}`);
      linhas.push(`*Pagamento:* ${pagamento}`);
      if(pagamento==='Pix'){linhas.push(`Chave Pix: ${PIX_KEY}`);}
      if(obs){linhas.push(`\nObs.: ${obs}`);}
      return linhas.join('\n');
    }

    document.getElementById('btnEnviar').addEventListener('click',()=>{
      if(cart.length===0)return;
      const msg=encodeURIComponent(montarMensagem());
      window.open(`https://wa.me/${WHATSAPP_NUMBER}?text=${msg}`,'_blank');
    });
  </script>
</body>
</html>
